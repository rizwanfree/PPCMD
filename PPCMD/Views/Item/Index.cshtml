@model IEnumerable<PPCMD.Models.BL>

@{
    ViewData["Title"] = "Consignments (BL Listing)";
}

<div class="card shadow-sm border-0 mt-3">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0 text-center">@ViewData["Title"]</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="blTable" class="table table-bordered table-striped table-sm" style="font-size: 0.875rem;">
                <thead class="table-light">
                    <tr>
                        <th>Job #</th>
                        <th>Client Name</th>
                        <th>LC + Date</th>
                        <th>BL + Date</th>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th style="width: 120px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var bl in Model)
                    {
                        <tr>
                            <td>@bl.PendingBL?.JobNumber</td>
                            <td>@bl.PendingBL?.Client?.ClientName</td>
                            <td>
                                @if (bl.LC != null)
                                {
                                    <text>@bl.LC.LCNumber - @bl.LC.Date.ToString("yyyy-MM-dd")</text>
                                }
                            </td>
                            <td>@bl.Id - @bl.BLDate.ToString("yyyy-MM-dd")</td>
                            <td>
                                @if (bl.PendingBL?.Items?.Any() == true)
                                {
                                    @string.Join(", ", bl.PendingBL.Items.Select(i => i.Item?.ItemName))
                                }
                            </td>
                            <td>
                                @if (bl.PendingBL?.Items?.Any() == true)
                                {
                                    @bl.PendingBL.Items.Sum(i => i.Quantity).ToString("N2")
                                }
                            </td>
                            <td>
                                <a href="#" class="btn btn-sm btn-primary">View</a>
                                <a href="#" class="btn btn-sm btn-warning">Edit</a>
                                <a href="#" class="btn btn-sm btn-danger">Delete</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#blTable').DataTable({
                pageLength: 10,
                order: [[1, "desc"]],
                columnDefs: [
                    { orderable: false, targets: -1 } // Disable sorting on Actions column
                ]
            });
        });
    </script>
}