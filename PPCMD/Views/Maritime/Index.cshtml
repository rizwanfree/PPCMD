@{
    ViewData["Title"] = "Maritime";
    var activeTab = string.IsNullOrEmpty(ViewContext.HttpContext.Request.Query["tab"])
        ? "Terminal"
        : ViewContext.HttpContext.Request.Query["tab"].ToString();
}

<div class="p-4 bg-white rounded shadow-sm">
    <h1 class="h4 mb-4 fw-bold">Maritime</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Terminal" ? "active" : "")" href="?tab=Terminal" data-tab="terminals">
                Terminals
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Lolo" ? "active" : "")" href="?tab=Lolo" data-tab="lolos">
                Lolos
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "ShippingLine" ? "active" : "")" href="?tab=ShippingLine" data-tab="shippinglines">
                Shipping Lines
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Ports" ? "active" : "")" href="?tab=Port" data-tab="ports">
                Ports
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Cities" ? "active" : "")" href="?tab=City" data-tab="cities">
                Cities
            </a>
        </li>
    </ul>

    <!-- Terminals -->
    <div id="terminals" class="tab-content @(activeTab == "Terminal" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateTerminal" asp-controller="Maritime" class="btn btn-primary">New Terminal</a>
        </div>
        <table id="terminalTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Terminal>)ViewBag.Terminals)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditTerminal" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="Terminal">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Lolos -->
    <div id="lolos" class="tab-content @(activeTab == "Lolo" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateLolo" asp-controller="Maritime" class="btn btn-primary">New Lolo</a>
        </div>
        <table id="loloTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Lolo>)ViewBag.Lolos)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditLolo" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="Lolo">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Shipping Lines -->
    <div id="shippinglines" class="tab-content @(activeTab == "ShippingLine" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateShippingLine" asp-controller="Maritime" class="btn btn-primary">New Shipping Line</a>
        </div>
        <table id="shippingLineTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.ShippingLine>)ViewBag.ShippingLines)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditShippingLine" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="ShippingLine">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Ports -->
    <div id="ports" class="tab-content @(activeTab == "Port" ? "d-block" : "d-none")">
        <div class="mb-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#portModal">New Port</button>
        </div>
        <table id="portTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Port>)ViewBag.Ports)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary editPortBtn"
                                    data-id="@item.Id"
                                    data-name="@item.Name"
                                    data-shortname="@item.ShortName"
                                    data-phone="@item.Phone"
                                    data-email="@item.Email">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="Port">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Cities -->
    <div id="cities" class="tab-content @(activeTab == "City" ? "d-block" : "d-none")">
        <div class="mb-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cityModal">New City</button>
        </div>
        <table id="cityTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.City>)ViewBag.Cities)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary editCityBtn"
                                    data-id="@item.Id"
                                    data-name="@item.Name">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="City">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>




    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this record? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form id="deleteForm" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

@section Scripts {
    <script>
        $(document).ready(function () {
            if ($.fn.DataTable) {
                $('#terminalTable').DataTable({ responsive: true, pageLength: 10 });
                $('#loloTable').DataTable({ responsive: true, pageLength: 10 });
                $('#shippingLineTable').DataTable({ responsive: true, pageLength: 10 });
            }

            const deleteBase = {
                Terminal: '@Url.Action("DeleteTerminal", "Maritime")',
                Lolo: '@Url.Action("DeleteLolo", "Maritime")',
                ShippingLine: '@Url.Action("DeleteShippingLine", "Maritime")',
                Port: '@Url.Action("DeletePort", "Maritime")',
                City: '@Url.Action("DeleteCity", "Maritime")'
            };

            $(document).on('click', '.deleteBtn', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const type = $(this).data('type');
                if (!id || !type || !deleteBase[type]) return;

                $('#deleteForm').attr('action', deleteBase[type] + '/' + id);
                const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
                modal.show();
            });

            // Optional: if you navigate by tabs via links and want Terminals active by default,
            // your server logic already sets `activeTab` — but if you need client-side fallback:
            const activeTab = '@(ViewContext.HttpContext.Request.Query["tab"].ToString() ?? "Terminal")';
            // You can ensure each tab-content uses activeTab to show/hide on server-side rendering.
        });
    </script>
}
