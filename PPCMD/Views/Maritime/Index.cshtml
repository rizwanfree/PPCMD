@{
    ViewData["Title"] = "Maritime";
    var activeTab = string.IsNullOrEmpty(ViewContext.HttpContext.Request.Query["tab"])
        ? "Terminal"
        : ViewContext.HttpContext.Request.Query["tab"].ToString();
}

<div class="p-4 bg-white rounded shadow-sm">
    <h1 class="h4 mb-4 fw-bold">Maritime</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Terminal" ? "active" : "")" href="?tab=Terminal" data-tab="terminals">
                Terminals
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Lolo" ? "active" : "")" href="?tab=Lolo" data-tab="lolos">
                Lolos
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "ShippingLine" ? "active" : "")" href="?tab=ShippingLine" data-tab="shippinglines">
                Shipping Lines
            </a>
        </li>
    </ul>

    <!-- Terminals -->
    <div id="terminals" class="tab-content @(activeTab == "Terminal" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateTerminal" asp-controller="Maritime" class="btn btn-primary">New Terminal</a>
        </div>
        <table id="terminalTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Terminal>)ViewBag.Terminals)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditTerminal" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="Terminal">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Lolos -->
    <div id="lolos" class="tab-content @(activeTab == "Lolo" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateLolo" asp-controller="Maritime" class="btn btn-primary">New Lolo</a>
        </div>
        <table id="loloTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Lolo>)ViewBag.Lolos)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditLolo" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="Lolo">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Shipping Lines -->
    <div id="shippinglines" class="tab-content @(activeTab == "ShippingLine" ? "d-block" : "d-none")">
        <div class="mb-3">
            <a asp-action="CreateShippingLine" asp-controller="Maritime" class="btn btn-primary">New Shipping Line</a>
        </div>
        <table id="shippingLineTable" class="table table-bordered table-striped w-100">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>NTN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.ShippingLine>)ViewBag.ShippingLines)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>
                        <td>@item.NTN</td>
                        <td class="d-flex gap-2">
                            <a asp-action="EditShippingLine" asp-controller="Maritime" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                            <button type="button" class="btn btn-sm btn-danger deleteBtn" data-id="@item.Id" data-type="ShippingLine">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>


    <!-- Ports -->
    <div id="ports" class="tab-content @(activeTab == "Port" ? "block" : "hidden")">
        <div class="mb-4">
            <a asp-action="CreatePort" asp-controller="Maritime" class="btn btn-primary">New Port</a>
        </div>
        <table id="portTable" class="display w-full">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Short Name</th>
                    <th>Phone</th>
                    <th>Email</th>                    
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (IEnumerable<PPCMD.Models.Port>)ViewBag.Ports)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.ShortName</td>
                        <td>@item.Phone</td>
                        <td>@item.Email</td>                        
                        <td class="flex space-x-2">
                            <a asp-action="EditPort" asp-controller="Maritime" asp-route-id="@item.Id" class="editBtn bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">Edit</a>
                            <button type="button"
                                    class="deleteBtn bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors"
                                    data-id="@item.Id"
                                    data-type="Port">
                                Delete
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>




<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
        <div class="flex items-center justify-between px-6 py-3 border-b">
            <h3 class="text-lg font-semibold text-gray-800">Confirm delete</h3>
            <button id="deleteClose" class="text-gray-500 text-2xl leading-none">&times;</button>
        </div>

            <div class="modal-body">
                <p>Are you sure you want to delete this record? This action cannot be undone.</p>
            </div>

            <div class="modal-footer">
                <button type="button" id="deleteCancel" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            if ($.fn.DataTable) {
                $('#terminalTable').DataTable({ responsive: true, pageLength: 10 });
                $('#loloTable').DataTable({ responsive: true, pageLength: 10 });
                $('#shippingLineTable').DataTable({ responsive: true, pageLength: 10 });
            }

            const deleteBase = {
                Terminal: '@Url.Action("DeleteTerminal", "Maritime")',
                Lolo: '@Url.Action("DeleteLolo", "Maritime")',
                ShippingLine: '@Url.Action("DeleteShippingLine", "Maritime")',
                Port: '@Url.Action("DeletePort", "Maritime")',
                City: '@Url.Action("DeleteCity", "Maritime")'
            };

            $(document).on('click', '.deleteBtn', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const type = $(this).data('type');
                if (!id || !type || !deleteBase[type]) return;

                $('#deleteForm').attr('action', deleteBase[type] + '/' + id);
                const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
                modal.show();
            });

            // Optional: if you navigate by tabs via links and want Terminals active by default,
            // your server logic already sets `activeTab` — but if you need client-side fallback:
            const activeTab = '@(ViewContext.HttpContext.Request.Query["tab"].ToString() ?? "Terminal")';
            // You can ensure each tab-content uses activeTab to show/hide on server-side rendering.
        });
    </script>
}
