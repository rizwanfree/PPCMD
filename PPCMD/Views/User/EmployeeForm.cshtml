@model PPCMD.Models.Employee

@{
    var isNew = Model?.Id == 0;
    ViewData["Title"] = isNew ? "Add Employee" : "Edit Employee";
}

<div class="container my-4">
    <div class="card shadow-lg rounded-3">
        <div class="card-body p-5">
            <h2 class="h4 fw-bold text-dark mb-4">@ViewData["Title"]</h2>

            <form asp-action="@(isNew ? "CreateEmployee" : "EditEmployee")" asp-controller="User" method="post" enctype="multipart/form-data">
                <input type="hidden" asp-for="Id" />

                <div class="row g-3">
                    <div class="col-md-6">
                        <label asp-for="FirstName" class="form-label">First name</label>
                        <input asp-for="FirstName" class="form-control rounded-3" />
                        <span asp-validation-for="FirstName" class="text-danger small"></span>
                    </div>

                    <div class="col-md-6">
                        <label asp-for="LastName" class="form-label">Last name</label>
                        <input asp-for="LastName" class="form-control rounded-3" />
                        <span asp-validation-for="LastName" class="text-danger small"></span>
                    </div>

                    <div class="col-md-6">
                        <label asp-for="Designation" class="form-label">Designation</label>
                        <input asp-for="Designation" class="form-control rounded-3" />
                    </div>

                    <div class="col-md-6">
                        <label asp-for="Mobile" class="form-label">Mobile</label>
                        <input asp-for="Mobile" class="form-control rounded-3" />
                    </div>

                    <div class="col-md-6">
                        <label asp-for="Email" class="form-label">Email</label>
                        <input asp-for="Email" type="email" class="form-control rounded-3" />
                        <span asp-validation-for="Email" class="text-danger small"></span>
                    </div>

                    <div class="col-md-6">
                        <label asp-for="CNIC" class="form-label">CNIC</label>
                        <input asp-for="CNIC" class="form-control rounded-3" />
                        <span asp-validation-for="CNIC" class="text-danger small"></span>
                    </div>

                    <div class="col-12">
                        <label asp-for="Address" class="form-label">Address</label>
                        <textarea asp-for="Address" rows="3" class="form-control rounded-3"></textarea>
                    </div>
                </div>

                <!-- Profile picture upload -->
                <div class="d-flex align-items-center mt-4">
                    <div class="flex-shrink-0 me-4">
                        <img id="profilePreview"
                             src="@(string.IsNullOrEmpty(Model?.ProfilePictureUrl) ? "/images/user.jpg" : Model.ProfilePictureUrl)"
                             alt="Profile"
                             class="rounded-circle border shadow-sm"
                             style="width: 110px; height: 110px; object-fit: cover;" />
                    </div>

                    <div class="flex-grow-1">
                        <label class="form-label">Profile picture</label>
                        <input asp-for="ImageFile" type="file" accept="image/*" class="form-control form-control-sm" />
                        <div class="form-text">JPG, PNG, WEBP — max 2MB.</div>
                        <span asp-validation-for="ImageFile" class="text-danger small d-block"></span>
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-2 mt-4">
                    <a asp-action="Index" class="btn btn-light rounded-3">Cancel</a>
                    <button type="submit" class="btn btn-primary rounded-3">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // preview selected image
        (function () {
            const input = document.querySelector('input[type="file"][asp-for="ImageFile"], input[type="file"][name="ImageFile"]');
            const preview = document.getElementById('profilePreview');
            if (!input) return;
            input.addEventListener('change', function () {
                const file = this.files && this.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function (ev) {
                    preview.src = ev.target.result;
                };
                reader.readAsDataURL(file);
            });
        })();
    </script>
}
