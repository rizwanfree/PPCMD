@model PPCMD.Models.BL

<style>
    .card .form-label,
    .card input,
    .card select {
        font-size: 0.85rem;
    }

    input[readonly],
    textarea[readonly],
    select[readonly] {
        background-color: #e9ecef;
        color: #495057;
        cursor: not-allowed;
    }

        input[readonly]:focus,
        textarea[readonly]:focus,
        select[readonly]:focus {
            outline: none;
            box-shadow: none;
        }

    .card-body {
        padding: 0.75rem !important;
    }

    .card-header {
        padding: 0.5rem !important;
    }

    .row {
        margin-bottom: 0.5rem;
    }

    .toast {
        z-index: 9999;
    }

    .nav-tabs .nav-link.active {
        font-weight: bold;
        background-color: #f8f9fa;
        border-bottom-color: #f8f9fa;
    }
</style>

<div class="card shadow-sm mt-3">
    <div class="card-header bg-primary text-white fw-bold">Create General Consignment</div>
    <div class="card-body">
        <!-- TABS -->
        <ul class="nav nav-tabs mb-3" id="createTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="job-tab" data-bs-toggle="tab" data-bs-target="#jobSection" type="button" role="tab">Job & Shipment Info</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="items-tab" data-bs-toggle="tab" data-bs-target="#itemsSection" type="button" role="tab">Items</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="payorder-tab" data-bs-toggle="tab" data-bs-target="#payorderSection" type="button" role="tab">Payorders</button>
            </li>
        </ul>

        <form asp-action="Create" method="post" id="consignmentForm">
            <div class="tab-content border rounded p-3 bg-light" id="createTabsContent">

                <!-- TAB 1: JOB & SHIPMENT -->
                <div class="tab-pane fade show active" id="jobSection" role="tabpanel" aria-labelledby="job-tab">
                    <div id="jobShipmentContent">
                        <!-- Job Section -->
                        <div class="card mb-2 shadow-sm">
                            <div class="card-header py1 bg-primary text-white">Job Information</div>
                            <div class="card-body py-2 px-2">
                                <div class="row">
                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.JobNumber" class="form-label">Job #</label>
                                        <input asp-for="PendingBL.JobNumber" class="form-control form-control-sm text-end" />
                                    </div>
                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.JobDate" class="form-label">Date</label>
                                        <input asp-for="PendingBL.JobDate" class="form-control form-control-sm date-input" type="text" />
                                    </div>
                                    <div class="col-md-4">
                                        <label asp-for="PendingBL.ClientId" class="form-label">Client</label>
                                        <select asp-for="PendingBL.ClientId" asp-items="ViewBag.Clients"
                                                class="form-select form-select-sm" id="clientSelect">
                                            <option value="">-- Select Client --</option>
                                        </select>
                                        <span asp-validation-for="PendingBL.ClientId" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-3">
                                        <label asp-for="PendingBL.Client.ContactPerson" class="form-label">Contact Person</label>
                                        <input asp-for="PendingBL.Client.ContactPerson"
                                               class="form-control form-control-sm" id="contactPerson" disabled />
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.IGM.PortId" class="form-label">Port</label>
                                        <select asp-for="PendingBL.IGM.PortId" asp-items="ViewBag.Ports" class="form-select form-select-sm">
                                            <option value="">-- Select Port --</option>
                                        </select>
                                        <span asp-validation-for="PendingBL.IGM.PortId" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Shipment Section -->
                        <div class="card mb-2 shadow-sm">
                            <div class="card-header py-1 bg-primary text-white">Shipment Information</div>
                            <div class="card-body py-2 px-2">
                                <div class="row">
                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.IGM.Number" class="form-label">IGM #</label>
                                        <input asp-for="PendingBL.IGM.Number" class="form-control form-control-sm text-end" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.IGM.Date" class="form-label">IGM Date</label>
                                        <input asp-for="PendingBL.IGM.Date" class="form-control form-control-sm date-input" type="text" />
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.IGM.Vessel" class="form-label">Vessel</label>
                                        <input asp-for="PendingBL.IGM.Vessel" class="form-control form-control-sm" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.IndexNumber" class="form-label">Index #</label>
                                        <input asp-for="PendingBL.IndexNumber" class="form-control form-control-sm text-end" />
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.BL.LC.LCNumber" class="form-label">LC/Contract #</label>
                                        <input asp-for="PendingBL.BL.LC.LCNumber" class="form-control form-control-sm" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.BL.LC.Date" class="form-label">Date</label>
                                        <input asp-for="PendingBL.BL.LC.Date" class="form-control form-control-sm date-input" type="text" />
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.BLNumber" class="form-label">BL #</label>
                                        <input asp-for="PendingBL.BLNumber" class="form-control form-control-sm" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.BLDate" class="form-label">Date</label>
                                        <input asp-for="PendingBL.BLDate" class="form-control form-control-sm date-input" type="text" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.BL.LC.ExchangeRate" class="form-label">Ex-Rate</label>
                                        <input asp-for="PendingBL.BL.LC.ExchangeRate" class="form-control form-control-sm" />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.BL.Containers" class="form-label">Containers</label>
                                        <input asp-for="PendingBL.BL.Containers" class="form-control form-control-sm text-end" />
                                    </div>

                                    <div class="col-md-1">
                                        <label asp-for="PendingBL.BL.Size" class="form-label">Size</label>
                                        <select name="ConsignmentType" class="form-select form-select-sm" required>
                                            <option value="">-- Select Size --</option>
                                            <option value="20">20 Feet</option>
                                            <option value="40">40 Feet</option>
                                        </select>
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.BL.Packages" class="form-label">Packages</label>
                                        <input asp-for="PendingBL.BL.Packages" class="form-control form-control-sm" placeholder="Example: 1500 Bags or 20 Pallets" />
                                    </div>

                                    <div class="col-md-3">
                                        <label asp-for="PendingBL.BL.LC.ShippingLineId" class="form-label">Shipping Line</label>
                                        <select asp-for="PendingBL.BL.LC.ShippingLineId" asp-items="ViewBag.ShippingLines" class="form-select form-select-sm" id="shippingLineSelect">
                                            <option value=""> -- Select Shipping Line -- </option>
                                        </select>
                                        <span asp-validation-for="PendingBL.BL.LC.ShippingLineId" class="text-danger"></span>
                                    </div>

                                    <div class="col-md-2">
                                        <label asp-for="PendingBL.BL.LC.LoloId" class="form-label">Lolo</label>
                                        <select asp-for="PendingBL.BL.LC.LoloId" asp-items="ViewBag.Lolos" class="form-select form-select-sm" id="loloSelect">
                                            <option value="">-- Select Lolo --</option>
                                        </select>
                                        <span asp-validation-for="PendingBL.BL.LC.LoloId" class="text-danger"></span>
                                    </div>

                                    <div class="col-md-3">
                                        <label asp-for="PendingBL.BL.LC.TerminalId" class="form-label">Terminals</label>
                                        <select asp-for="PendingBL.BL.LC.TerminalId" asp-items="ViewBag.Terminals" class="form-select form-select-sm" id="terminalSelect">
                                            <option value="">-- Select Terminal --</option>
                                        </select>
                                        <span asp-validation-for="PendingBL.BL.LC.TerminalId" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <button type="button" class="btn btn-primary next-tab" data-next="#itemsSection">Next →</button>
                    </div>
                </div>

                <!-- TAB 2: ITEMS -->
                <div class="tab-pane fade" id="itemsSection" role="tabpanel" aria-labelledby="items-tab">
                    <div class="card mb-2 shadow-sm">
                        <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                            <span>Items</span>
                            <button type="button" class="btn btn-sm btn-success" id="addItem">+ Add Item</button>
                        </div>
                        <div class="card-body">
                            <div id="itemsContainer">
                                <!-- Dynamic items will be added here -->
                            </div>
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <button type="button" class="btn btn-secondary prev-tab" data-prev="#jobSection">← Back</button>
                        <button type="button" class="btn btn-primary next-tab" data-next="#payorderSection">Next →</button>
                    </div>
                </div>

                <!-- TAB 3: PAYORDERS -->
                <div class="tab-pane fade" id="payorderSection" role="tabpanel" aria-labelledby="payorder-tab">
                    <div class="card mb-2 shadow-sm">
                        <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                            <span>Payorders</span>
                            <small class="text-light">Enter amounts for applicable payorders. Leave as 0.00 to exclude.</small>
                        </div>
                        <div class="card-body py-2 px-2">
                            <div class="table-responsive">
                                <table class="table table-sm table-bordered align-middle" id="payordersTable">
                                    <thead class="table-light">
                                        <tr class="text-center">
                                            <th style="width: 5%">#</th>
                                            <th style="width: 25%">Particular</th>
                                            <th style="width: 50%">Detail</th>
                                            <th style="width: 20%">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Dynamic rows will be populated by JavaScript -->
                                    </tbody>
                                    <tfoot class="table-secondary">
                                        <tr>
                                            <th colspan="3" class="text-end">Total Amount:</th>
                                            <th class="text-center" id="totalPayorderAmount">0.00</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <button type="button" class="btn btn-secondary prev-tab">← Back</button>
                        <button type="submit" class="btn btn-success">Create Consignment</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {

    <script>
        // Global variables
        window.itemsWithDuties = @Html.Raw(Json.Serialize(ViewBag.ItemsWithDuties));
        window.payorderHeaders = @Html.Raw(Json.Serialize(ViewBag.PayorderHeaders));
    </script>

    <script src="~/js/consignments/job-shipment-tab.js"></script>
    <script src="~/js/consignments/items-tab.js"></script>
    <script src="~/js/consignments/payorder-tab.js"></script>
    <script src="~/js/consignments/tab-navigation.js"></script>
}