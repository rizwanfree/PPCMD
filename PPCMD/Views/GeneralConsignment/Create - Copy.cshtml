@model PPCMD.Models.BL // Using BL as main model, but form will collect data for all entities


<style>
.card .form-label,
.card input,
.card select {
    font-size: 0.85rem;
}

input[readonly],
textarea[readonly],
select[readonly] {
    background-color: #e9ecef; /* slightly darker than default */
    color: #495057; /* dark text */
    cursor: not-allowed; /* shows "disabled" cursor */
}

input[readonly]:focus,
textarea[readonly]:focus,
select[readonly]:focus {
    outline: none; /* remove focus ring */
    box-shadow: none;
}

.card-body {
    padding: 0.75rem !important;
}
/* Was py-2 px-2; now tighter */
.card-header {
    padding: 0.5rem !important;
}

.row {
    margin-bottom: 0.5rem;
}
/* Less gap between rows */

.toast {
    z-index: 9999;
}
</style>
<form asp-action="Create" method="post">
    <!-- Job Section -->
    <div class="card mb-2 shadow-sm">
        <div class="card-header py1 bg-primary text-white">Job Information</div>
        <div class="card-body py-2 px-2">
            <div class="row">
                <div class="col-md-1">
                    <label asp-for="PendingBL.JobNumber" class="form-label">Job #</label>
                    <input asp-for="PendingBL.JobNumber" class="form-control form-control-sm text-end" />
                </div>
                <div class="col-md-1">
                    <label asp-for="PendingBL.JobDate" class="form-label">Date</label>                    
                    <input asp-for="PendingBL.JobDate" class="form-control form-control-sm date-input" type="text" />
                </div>
                <div class="col-md-3">
                    <label asp-for="PendingBL.ClientId" class="form-label">Client</label>
                    <select asp-for="PendingBL.ClientId" asp-items="ViewBag.Clients"
                            class="form-select form-select-sm" id="clientSelect">
                        <option value="">-- Select Client --</option>
                    </select>
                    <span asp-validation-for="PendingBL.ClientId" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="PendingBL.Client.ContactPerson" class="form-label">Contact Person</label>
                    <input asp-for="PendingBL.Client.ContactPerson"
                           class="form-control form-control-sm" id="contactPerson" disabled />
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.IGM.PortId" class="form-label">Port</label>
                    <select asp-for="PendingBL.IGM.PortId" asp-items="ViewBag.Ports" class="form-select form-select-sm">
                        <option value="">-- Select Port --</option>
                    </select>
                    <span asp-validation-for="PendingBL.IGM.PortId" class="text-danger"></span>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Consignment Type</label>
                    <select name="ConsignmentType" class="form-select form-select-sm" required>
                        <option value="">-- Select Consignment --</option>
                        @foreach (var c in ViewBag.ConsignmentType as List<SelectListItem>)
                        {
                            <option value="@c.Value">@c.Text</option>
                        }
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Shipment Section -->
    <div class="card mb-2 shadow-sm">
        <div class="card-header py-1 bg-primary text-white">Shipment Information</div>
        <div class="card-body py-2 px-2">
            <div class="row">
                <div class="col-md-1">
                    <label asp-for="PendingBL.IGM.Number" class="form-label">IGM #</label>
                    <input asp-for="PendingBL.IGM.Number" class="form-control form-control-sm text-end" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.IGM.Date" class="form-label">IGM Date</label>
                    <input asp-for="PendingBL.IGM.Date" class="form-control form-control-sm date-input" type="text" />
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.IGM.Vessel" class="form-label">Vessel</label>
                    <input asp-for="PendingBL.IGM.Vessel" class="form-control form-control-sm" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.IndexNumber" class="form-label">Index #</label>
                    <input asp-for="PendingBL.IndexNumber" class="form-control form-control-sm text-end" />
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.BL.LC.LCNumber" class="form-label">LC/Contract #</label>
                    <input asp-for="PendingBL.BL.LC.LCNumber" class="form-control form-control-sm" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.BL.LC.Date" class="form-label">Date</label>
                    <input asp-for="PendingBL.BL.LC.Date" class="form-control form-control-sm date-input" type="text" />
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.BLNumber" class="form-label">BL #</label>
                    <input asp-for="PendingBL.BLNumber" class="form-control form-control-sm" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.BLDate" class="form-label">Date</label>
                    <input asp-for="PendingBL.BLDate" class="form-control form-control-sm date-input" type="text" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.BL.LC.ExchangeRate" class="form-label">Ex-Rate</label>
                    <input asp-for="PendingBL.BL.LC.ExchangeRate" class="form-control form-control-sm" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-1">
                    <label asp-for="PendingBL.BL.Containers" class="form-label">Containers</label>
                    <input asp-for="PendingBL.BL.Containers" class="form-control form-control-sm text-end" />
                </div>

                <div class="col-md-1">
                    <label asp-for="PendingBL.BL.Size" class="form-label">Size</label>

                    <select asp-for="PendingBL.BL.Size" class="form-select form-select-sm" required>
                        <option value="">-- Select Size --</option>
                        <option value="20">20 Feet</option>
                        <option value="40">40 Feet</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.BL.Packages" class="form-label">Packages</label>
                    <input asp-for="PendingBL.BL.Packages" class="form-control form-control-sm" placeholder="Example: 1500 Bags or 20 Pallets" />
                </div>


                <div class="col-md-3">
                    <label asp-for="PendingBL.BL.LC.ShippingLineId" class="form-label">Shipping Line</label>
                    <select asp-for="PendingBL.BL.LC.ShippingLineId" asp-items="ViewBag.ShippingLines" class="form-select form-select-sm">
                        <option value="">-- Select Shipping Line --</option>
                    </select>
                    <span asp-validation-for="PendingBL.IGM.PortId" class="text-danger"></span>
                </div>

                <div class="col-md-2">
                    <label asp-for="PendingBL.BL.LC.LoloId" class="form-label">Lolo</label>
                    <select asp-for="PendingBL.BL.LC.LoloId" asp-items="ViewBag.Lolos" class="form-select form-select-sm">
                        <option value="">-- Select Lolo --</option>
                    </select>
                    <span asp-validation-for="PendingBL.BL.LC.LoloId" class="text-danger"></span>
                </div>

                <div class="col-md-3">
                    <label asp-for="PendingBL.BL.LC.TerminalId" class="form-label">Terminals</label>
                    <select asp-for="PendingBL.BL.LC.TerminalId" asp-items="ViewBag.Terminals" class="form-select form-select-sm">
                        <option value="">-- Select Terminal --</option>
                    </select>
                    <span asp-validation-for="PendingBL.BL.LC.TerminalId" class="text-danger"></span>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Items Section -->
    <div class="card mb-2 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
            <span>Items</span>
            <button type="button" class="btn btn-sm btn-success" id="addItem">+ Add Item</button>
        </div>
        <div class="card-body">
            <div id="itemsContainer">
                <!-- Dynamic items will be added here -->
            </div>
        </div>
    </div>

    <!-- Payorders Section -->
    <div class="card mb-2 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
            <span>Payorders</span>
            <button type="button" class="btn btn-sm btn-success" id="addPayorder">+ Add Payorder</button>
        </div>
        <div class="card-body py-2 px-2">
            <div class="table-responsive">
                <table class="table table-sm table-bordered align-middle" id="payordersTable">
                    <thead class="table-light">
                        <tr class="text-center">
                            <th style="width: 5%">#</th>
                            <th style="width: 30%">Particular</th>
                            <th style="width: 40%">Detail</th>
                            <th style="width: 20%">Amount</th>
                            <th style="width: 5%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Create Consignment</button>
    </div>
</form>


@section Scripts {
    <script src="~/js/general-consignment-create.js"></script>
    <script>
        // Pass server-side data to external JS - load AFTER the main file
        window.itemsWithDuties = @Html.Raw(Json.Serialize(ViewBag.ItemsWithDuties));

        // Initialize after data is set
        document.addEventListener('DOMContentLoaded', function() {
            if (window.initializeConsignmentForm) {
                window.initializeConsignmentForm();
            }
        });
    </script>
}