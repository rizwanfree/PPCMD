@model IEnumerable<PPCMD.Models.Client>

@{
    ViewData["Title"] = "Clients";
}

<div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Clients</h1>
    <a asp-action="Create"
       class="inline-flex items-center px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 transition">
        ➕ Add Client
    </a>
</div>

<!-- Search Bar -->
<div class="mb-4">
    <input type="text"
           id="searchInput"
           placeholder="Search clients..."
           class="w-full md:w-1/3 px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-emerald-300">
</div>

<!-- Card Grid -->
<div id="clientsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
    @foreach (var client in Model)
    {
        <div class="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition p-4 h-52 flex flex-col justify-between client-card"
             data-name="@client.ClientName @client.ContactPerson @client.Mobile">
            <div>
                <h2 class="font-semibold text-lg truncate mb-1">@client.ClientName</h2>
                <p class="text-sm text-gray-600">📌 @client.ContactPerson</p>
                <p class="text-sm text-gray-600">📱 @client.Mobile</p>
                <p class="text-sm text-gray-600">
                    ✉️ @(client.Emails.FirstOrDefault()?.Email ?? "No Email")
                </p>
            </div>

            <div class="flex justify-end mt-2">
                <a asp-action="Details" asp-route-id="@client.Id"
                   class="px-3 py-1 rounded bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm">
                    🔍 Details
                </a>
            </div>
        </div>
    }
</div>

<!-- Pagination -->
<div class="flex justify-center mt-6 space-x-2">
    <button onclick="changePage(-1)"
            class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm">
        ⬅ Prev
    </button>
    <span id="pageIndicator" class="text-gray-700 text-sm">Page 1</span>
    <button onclick="changePage(1)"
            class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm">
        Next ➡
    </button>
</div>

<script>
    const cardsPerPage = 10; // Show 10 clients per page
    let currentPage = 1;

    function filterCards() {
        const searchTerm = document.getElementById("searchInput").value.toLowerCase();
        const cards = document.querySelectorAll(".client-card");
        cards.forEach(card => {
            const name = card.dataset.name.toLowerCase();
            card.style.display = name.includes(searchTerm) ? "" : "none";
        });
        currentPage = 1;
        paginateCards();
    }

    function paginateCards() {
        const cards = Array.from(document.querySelectorAll(".client-card"))
            .filter(card => card.style.display !== "none");

        const totalPages = Math.ceil(cards.length / cardsPerPage);
        document.getElementById("pageIndicator").innerText = `Page ${currentPage} of ${totalPages || 1}`;

        cards.forEach((card, index) => {
            const start = (currentPage - 1) * cardsPerPage;
            const end = start + cardsPerPage;
            card.style.display = (index >= start && index < end) ? "" : "none";
        });
    }

    function changePage(step) {
        const cards = Array.from(document.querySelectorAll(".client-card"))
            .filter(card => card.style.display !== "none");
        const totalPages = Math.ceil(cards.length / cardsPerPage);
        currentPage = Math.max(1, Math.min(currentPage + step, totalPages));
        paginateCards();
    }

    document.getElementById("searchInput").addEventListener("input", filterCards);
    document.addEventListener("DOMContentLoaded", paginateCards);
</script>
